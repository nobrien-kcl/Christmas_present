<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Christmas Present</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: #eee;
  margin: 0;
  padding: 20px;
}

h1 { text-align: center; }

.games {
  display: grid;
  grid-template-columns: repeat(2, minmax(320px, 1fr));
  gap: 30px;
}

@media (max-width: 800px) {
  .games { grid-template-columns: 1fr; }
}

.game {
  max-width: 360px;
  margin: auto;
}

.row {
  display: flex;
  justify-content: center;
  margin: 4px 0;
}

.tile {
  width: 44px;
  height: 44px;
  border: 2px solid #333;
  margin: 2px;
  font-size: 28px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  text-transform: uppercase;
}

.correct { background:#6aaa64; border-color:#6aaa64; }
.present { background:#c9b458; border-color:#c9b458; }
.absent  { background:#3a3a3c; border-color:#3a3a3c; }

.hidden { display: none; }

input, button {
  width: 100%;
  font-size: 18px;
  padding: 8px;
  margin-top: 6px;
}

.keyboard-holder { margin-top: 15px; }

.krow {
  display: flex;
  justify-content: center;
  margin-bottom: 6px;
}

.key {
  background: #555;
  color: #fff;
  padding: 10px;
  margin: 2px;
  min-width: 32px;
  text-align: center;
  border-radius: 4px;
  font-weight: bold;
}

.key.correct { background:#6aaa64; }
.key.present { background:#c9b458; }
.key.absent  { background:#3a3a3c; }

/* üéÅ POPUP MODAL */
#overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

#popup {
  background: #222;
  border-radius: 12px;
  padding: 30px 40px;
  text-align: center;
  max-width: 420px;
  animation: pop 0.4s ease;
}

@keyframes pop {
  from { transform: scale(0.7); opacity: 0; }
  to   { transform: scale(1); opacity: 1; }
}

/* üéâ CONFETTI */
.confetti {
  position: fixed;
  width: 8px;
  height: 8px;
  top: -10px;
  animation: fall 3s linear forwards;
}

@keyframes fall {
  to {
    transform: translateY(110vh) rotate(720deg);
    opacity: 0;
  }
}
</style>
</head>

<body>
<h1>Christmas Present Puzzle üéÑ</h1>

<div class="games">

  <div id="game1" class="game">
    <h2>Puzzle 1 (7)</h2>
    <div id="grid1"></div>
    <div id="msg1"></div>
    <input id="guess1" maxlength="7">
    <button onclick="submitGuess(1)">Guess</button>
    <div class="keyboard-holder" id="kb-holder-1"></div>
  </div>

  <div id="game2" class="game hidden">
    <h2>Puzzle 2 (6)</h2>
    <div id="grid2"></div>
    <div id="msg2"></div>
    <input id="guess2" maxlength="6">
    <button onclick="submitGuess(2)">Guess</button>
    <div class="keyboard-holder hidden" id="kb-holder-2"></div>
  </div>

  <div id="game3" class="game hidden">
    <h2>Puzzle 3 (4)</h2>
    <div id="grid3"></div>
    <div id="msg3"></div>
    <input id="guess3" maxlength="4">
    <button onclick="submitGuess(3)">Guess</button>
    <div class="keyboard-holder hidden" id="kb-holder-3"></div>
  </div>

  <div id="game4" class="game hidden">
    <h2>Puzzle 4 (6)</h2>
    <div id="grid4"></div>
    <div id="msg4"></div>
    <input id="guess4" maxlength="6">
    <button onclick="submitGuess(4)">Guess</button>
    <div class="keyboard-holder hidden" id="kb-holder-4"></div>
  </div>

</div>

<!-- üéÅ FINAL POPUP -->
<div id="overlay">
  <div id="popup">
    <h2>üéâ Surprise! üéâ</h2>
    <p><strong>SNOW PATROL</strong></p>
    <p>Crystal Palace Park</p>
    <p>6th July 2026 üé∂</p>
  </div>
</div>

<script>
const ANSWERS={1:"crystal",2:"palace",3:"snow",4:"patrol"};
const MAX=6, rows=["qwertyuiop","asdfghjkl","zxcvbnm"];
let state={1:{t:0},2:{t:0},3:{t:0},4:{t:0}}, keyState={};

function grid(n,l){
  const g=document.getElementById("grid"+n);
  for(let r=0;r<MAX;r++){
    const row=document.createElement("div"); row.className="row";
    for(let c=0;c<l;c++){
      const t=document.createElement("div");
      t.className="tile"; t.id=`t-${n}-${r}-${c}`;
      row.appendChild(t);
    }
    g.appendChild(row);
  }
}
grid(1,7); grid(2,6); grid(3,4); grid(4,6);

function buildKB(id){
  const h=document.getElementById(id); h.innerHTML="";
  rows.forEach(r=>{
    const row=document.createElement("div"); row.className="krow";
    [...r].forEach(l=>{
      const k=document.createElement("div");
      k.className="key"; k.id="key-"+l; k.textContent=l.toUpperCase();
      row.appendChild(k);
    });
    h.appendChild(row);
  });
}
buildKB("kb-holder-1");

function confetti(){
  for(let i=0;i<150;i++){
    const c=document.createElement("div");
    c.className="confetti";
    c.style.left=Math.random()*100+"vw";
    c.style.background=`hsl(${Math.random()*360},100%,50%)`;
    c.style.animationDuration=2+Math.random()*2+"s";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),4000);
  }
}

function submitGuess(n){
  const input=document.getElementById("guess"+n);
  const guess=input.value.toLowerCase(); input.value="";
  const ans=ANSWERS[n]; if(guess.length!==ans.length) return;

  let freq={}, res=Array(ans.length).fill("absent");
  [...ans].forEach(c=>freq[c]=(freq[c]||0)+1);
  for(let i=0;i<ans.length;i++){
    if(guess[i]===ans[i]){res[i]="correct"; freq[guess[i]]--;}
  }
  for(let i=0;i<ans.length;i++){
    if(res[i]==="absent" && freq[guess[i]]>0){
      res[i]="present"; freq[guess[i]]--;
    }
  }

  const r=state[n].t;
  res.forEach((s,i)=>{
    const t=document.getElementById(`t-${n}-${r}-${i}`);
    t.textContent=guess[i]; t.classList.add(s);
    const k=document.getElementById("key-"+guess[i]);
    k.className="key "+s;
  });

  if(guess===ans){
    document.getElementById("kb-holder-"+n).classList.add("hidden");
    if(n<4){
      document.getElementById("game"+(n+1)).classList.remove("hidden");
      document.getElementById("kb-holder-"+(n+1)).classList.remove("hidden");
      buildKB("kb-holder-"+(n+1));
    } else {
      confetti();
      document.getElementById("overlay").style.display="flex";
    }
  }
  state[n].t++;
}
</script>
</body>
</html>
